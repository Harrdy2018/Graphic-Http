# 传输层

# OSI模型和DoD模型
***
![](https://github.com/Harrdy2018/Graphic-Http/blob/master/OSI%20and%20DoD.png)
***
```
DoD(Departemnt of Defense 国防部)模型，也就是TCP/IP模型
TCP(Transmission Control Protocol 传输控制协议)
UDP(User Data Protocol 用户数据报协议)
什么时候使用？
TCP:需要将要传输的文件分段，传输建立会话，可靠传输，流量控制
UDP:一个数据报就能完成通信，不需要建立会话，不需要流量控制，不可靠传输
```

***
```
PDU(Protocol Data Unit 协议数据单元)表示对等层之间传递的数据单位
应用层的PDU---------->>报文(message)
传输层的PDU---------->>数据段(segment)
网络层的PDU---------->>数据包(packet)
数据链路层的PDU------>>数据帧(frame)
物理层的PDU---------->>数据位(bit)
```

***
**IP分组的最大字节数是65535字节还是65536字节？？**
```
2^(16)=65536    
区间为0~65535字节
数据包的最大长度的字段是16位，那么这16位所能表示的最大数字就是(2^16-1)，
二进制就是16个1排起来，所以数据包的最大长度就是65535
```

***
# IPv4数据包格式
***
![](https://github.com/Harrdy2018/Graphic-Http/blob/master/IPv4%20packet.png)
***
* 版本(Version):长度4bit,标识目前采用的 IP 协议的版本号。一般的值为 0100（IPv4),0110（IPv6）
***
|版本号|版本|RFC文档|
|:-----|:-----|:-----|
|0|保留||
|1~3|未分配||
|4|Internet 协议版本 4（IPv4）|RFC791|
|5|ST 数据报（Datagram）|RFC1190|
|6|IPv6|RFC1883|
|7|TP / IX|	RFC1475|
|8|P Internet 协议（PIP）|RFC1621|
|9|使用更大地址的 TCP 和 UDP（TUBA）|RFC1347|
|10~14|未分配||
|15|保留||
***

* 首部长度(Header Length):长度 4 bit 。这个字段的作用是为了描述 IP 报头的长度，因为在 IP 报头中有变长的可选部分。该部分占 4 个 bit，长度单位为 4 个字节，即本区域值 = IP 头部长度（单位为字节）/ 长度单位（4 个字节）。因此，一个 IP 报头的长度最长为 “ 1111 ”，即 15 x 4 个字节 = 60 个字节。IP 报头最小长度为 20 字节。
***
|Header Length|Header Length所代表的实际的IP报头长度|
|:-----|:-----|
|0101|20字节|
|0110|24字节|
|0111|28字节|
|...|...|
|1101|52字节|
|1110|56字节|
|1111|60字节|
***

* 服务类型(Type of Service):长度8bit,8位按位被如下定义：PPP DTRC0（更多详细信息可以参见 RFC1340 和 RFC1349）
```
PPP：前 3 位，定义包的优先级，取值越大数据越重要
000 普通（Routine）
001 优先的（Priority）
010 立即的发送（Immediate）
011 闪电式的（Flash）
100 比闪电还闪电式的（Flash Override）
101 CRI / TIC / ECP（找不到这个词的翻译）
110 网间控制（Internetwork Control）
111 网络控制（Network Control）
DTRCO：后 5 位
D 时延：0：普通，1：延迟尽量小
T 吞吐量：0：普通，1：流量尽量大
R 可靠性：0：普通，1：可靠性尽量大
M 传输成本：0：普通，1：成本尽量小
0 最后一位被保留，恒定为 0
```

***
**这里的bit和我们原来以为的1Byte=8bit的含义不一样**
* IP包总长度(Total Length):长度16bit。<br>
**以字节为单位计算的 IP 包的长度（包括头部和数据）,也就是说单位为字节，1bit的话，可表示的最大十进制数为2，相当于2字节**，
所以IP包最大长度2^16-1=65535字节。<br>
所以，数据包有效载荷的大小 = IP包总长度(Total Length)-IP报头长度(Header Length)
